---
- name: define tmpdir
  set_fact:
    rclone_setup_tmp_dir: "/tmp/rclone_setup"

- name: install unzip
  apt: 
    name: unzip
    state: present
  become: yes

- name: make temp dir
  file:
    path: "{{ rclone_setup_tmp_dir}}"
    state: directory
    mode: 0775

- name: unzip package
  unarchive:
    src: https://github.com/ncw/rclone/releases/download/v{{ rclone_version }}/rclone-v{{ rclone_version }}-linux-amd64.zip
    dest: "{{ rclone_setup_tmp_dir}}"
    copy: no
  become: yes

- name: copy binary
  copy:
    src: "{{ rclone_setup_tmp_dir}}/rclone-v{{ rclone_version }}-linux-amd64/rclone"
    dest: "/usr/bin/rclone"
    mode: 0755
    owner: root
    group: root
    remote_src: true
  become: yes

- name: make dir for local manpages
  file:
    path: /usr/local/share/man/man1
    state: directory
    mode: 0775
    owner: root
    group: staff

- name: copy manpage
  copy:
    src: "{{ rclone_setup_tmp_dir}}/rclone-v{{ rclone_version }}-linux-amd64/rclone.1"
    dest: "/usr/local/share/man/man1/rclone.1"
    mode: 0644
    owner: root
    group: root
    remote_src: true
  become: yes

- name: install manpage
  shell: mandb
  become: yes

- name: add configuration rclone
  template:
    src: ".rclone.conf.{{ rclone_type_storage }}.j2"
    dest: "/root/.rclone.conf"
    owner: root
    group: root
    mode: 0700


- debug: msg={{ hostvars[groups['db'][0]]['ansible_eth0']['ipv4']['address'] }}

